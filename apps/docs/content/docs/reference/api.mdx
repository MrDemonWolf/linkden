---
title: API Reference
description: Complete reference for LinkDen's tRPC API â€” architecture, authentication, and all endpoints.
---

# API Reference

LinkDen's API is built with [tRPC](https://trpc.io/) v11 on top of [Hono](https://hono.dev/), running on Cloudflare Workers.

## Architecture

```
Next.js Frontend (apps/web)
       |
       | tRPC Client (HTTP requests)
       |
       v
Hono Server (apps/server)
       |
       |-- Better Auth (session validation)
       |-- tRPC Router (packages/api)
       |
       v
Drizzle ORM (packages/db)
       |
       | SQL queries
       |
       v
Cloudflare D1 (SQLite)
```

- **Hono** -- Ultra-lightweight web framework for edge runtimes. Handles routing, middleware, and request/response processing with zero cold start on Cloudflare Workers.
- **tRPC v11** -- End-to-end type safety without code generation. Router definitions live in `packages/api`.
- **Better Auth** -- Email/password authentication. Session cookies are validated on protected procedures.
- **Drizzle ORM** -- Type-safe SQL query builder for Cloudflare D1. Schema in `packages/db/src/schema/`.

## Authentication

LinkDen uses [Better Auth](https://www.better-auth.com/) with email/password sign-in.

### Session Flow

1. During first-time setup at `/admin/setup`, you create an admin account.
2. Better Auth creates a session with secure cookies.
3. For subsequent visits, sign in at `/admin/login`.
4. The session cookie is sent with all API requests to authenticate protected routes.

### Cookie Configuration

| Attribute | Value | Reason |
|-----------|-------|--------|
| `sameSite` | `none` | Required for cross-origin requests |
| `secure` | `true` | Required when `sameSite` is `none` |
| `httpOnly` | `true` | Prevents JavaScript access to session cookie |

### Environment Variables

| Variable | Description |
|----------|-------------|
| `BETTER_AUTH_SECRET` | Secret key for session signing |
| `BETTER_AUTH_URL` | Base URL for the auth server (API server URL) |
| `CORS_ORIGIN` | Trusted origin for the frontend |

Generate a secret with: `openssl rand -base64 32`

### Troubleshooting Auth

- **401 Unauthorized** -- Check `BETTER_AUTH_SECRET` is set and consistent. Verify `CORS_ORIGIN` matches the frontend URL exactly.
- **Cannot create account** -- Use the setup wizard at `/admin/setup` for the initial account.
- **CORS errors** -- `CORS_ORIGIN` must match the frontend URL including protocol, no trailing slash.

---

## Endpoint Reference

All endpoints are available at `/trpc/<router>.<procedure>`. Public procedures require no authentication. Protected procedures require a valid Better Auth session cookie.

### Blocks

Manage content blocks on your page.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `blocks.list` | Query | Protected | Get all blocks ordered by position |
| `blocks.get` | Query | Protected | Get a single block by ID |
| `blocks.create` | Mutation | Protected | Create a new block with client-generated ID |
| `blocks.update` | Mutation | Protected | Update block fields by ID |
| `blocks.delete` | Mutation | Protected | Delete a block by ID |
| `blocks.reorder` | Mutation | Protected | Batch update block positions |
| `blocks.toggleEnabled` | Mutation | Protected | Toggle `isEnabled` field |

#### Block Types

```typescript
type BlockType = "link" | "header" | "social_icons" | "embed" | "contact_form"
```

#### Block Fields

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Unique block ID |
| `type` | BlockType | Block type |
| `title` | string | Display title |
| `url` | string? | Destination URL (link blocks) |
| `icon` | string? | Icon identifier |
| `embedType` | string? | Embed provider |
| `embedUrl` | string? | Embed source URL |
| `socialIcons` | string? | JSON string of social icon data |
| `isEnabled` | boolean | Visibility on public page |
| `position` | number | Display order |
| `scheduledStart` | string? | ISO datetime for scheduled visibility start |
| `scheduledEnd` | string? | ISO datetime for scheduled visibility end |
| `config` | string? | JSON string of block configuration |

### Settings

Manage site-wide key-value configuration.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `settings.get` | Query | Protected | Get a single setting by key |
| `settings.getAll` | Query | Protected | Get all settings as key-value map |
| `settings.update` | Mutation | Protected | Upsert a single key-value pair |
| `settings.updateBulk` | Mutation | Protected | Upsert an array of key-value pairs |

#### Common Settings Keys

| Key | Description |
|-----|-------------|
| `profile_name` | Display name |
| `bio` | Bio text |
| `avatar_url` | Avatar image URL |
| `verified_badge` | Show verified checkmark |
| `theme_preset` | Theme ID |
| `seo_title` | Page title |
| `seo_description` | Meta description |
| `seo_og_image` | Open Graph image URL |
| `contact_form_enabled` | Contact form toggle |
| `contact_delivery` | Delivery mode |
| `captcha_provider` | CAPTCHA mode |
| `branding_enabled` | Whitelabel footer toggle |
| `branding_text` | Custom footer text |
| `branding_link` | Custom footer link |
| `vcard_enabled` | vCard download toggle |
| `wallet_enabled` | Apple Wallet toggle |
| `setup_completed` | Setup wizard completion flag |

### Contacts

Handle contact form submissions.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `contacts.list` | Query | Protected | List submissions with optional `isRead` filter, limit/offset pagination |
| `contacts.get` | Query | Protected | Get a single submission by ID |
| `contacts.markRead` | Mutation | Protected | Mark submission as read |
| `contacts.markUnread` | Mutation | Protected | Mark submission as unread |
| `contacts.delete` | Mutation | Protected | Delete a submission |
| `contacts.unreadCount` | Query | Protected | Count of unread submissions |

### Analytics

Track and query page view and click data. All queries accept an optional `{ period: "7d" | "30d" | "90d" }` parameter.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `analytics.overview` | Query | Protected | Returns `{ totalViews, totalClicks }` for period |
| `analytics.viewsOverTime` | Query | Protected | Returns `[{ date, count }]` grouped by day |
| `analytics.clicksOverTime` | Query | Protected | Returns `[{ date, count }]` grouped by day |
| `analytics.topLinks` | Query | Protected | Top 10 links by click count |
| `analytics.referrers` | Query | Protected | Top 10 referrer domains |
| `analytics.countries` | Query | Protected | Top 20 countries by page view count |

### Social

Manage social network entries for use in Social Icons blocks.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `social.list` | Query | Protected | List all networks with optional `activeOnly` filter |
| `social.toggle` | Mutation | Protected | Set `isActive` true/false for a network by slug |

### Wallet

Manage Apple Wallet pass configuration.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `wallet.getConfig` | Query | Protected | Get wallet settings |
| `wallet.updateConfig` | Mutation | Protected | Update wallet settings |
| `wallet.generatePreview` | Query | Protected | Returns profile + enabled blocks + QR URL for pass preview |

### vCard

Manage and generate vCard contact files.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `vcard.getConfig` | Query | Protected | Get `{ enabled, data }` |
| `vcard.updateConfig` | Mutation | Protected | Update enabled flag and/or vCard data fields |
| `vcard.preview` | Query | Protected | Returns generated `.vcf` string |

#### vCard Data Fields

`fullName`, `nickname`, `birthday`, `photo`, `org`, `title`, `department`, `workEmail`, `workPhone`, `email`, `phone`, `address`, `urls` (array of `{ label, url }`).

### Backup

Import and export all data.

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `backup.export` | Query | Protected | Export all data as JSON |
| `backup.import` | Mutation | Protected | Import data with `mode: "merge"` or `"replace"` |

### Version

| Procedure | Type | Auth | Description |
|-----------|------|------|-------------|
| `version.current` | Query | Public | Returns `{ version }` |
| `version.checkUpdate` | Query | Public | Returns `{ current, latest, hasUpdate, releaseUrl, changelog }` |

### Public

Public-facing endpoints (no authentication).

| Procedure | Type | Description |
|-----------|------|-------------|
| `public.getPage` | Query | Full page data: profile, schedule-filtered blocks, theme, settings |
| `public.submitContact` | Mutation | Submit contact form; validates CAPTCHA if configured |
| `public.trackView` | Mutation | Record page view with referrer, userAgent, country |
| `public.trackClick` | Mutation | Record link click with blockId, referrer, userAgent, country |
| `public.getVCard` | Query | Returns VCard string if vcard is enabled |
| `public.getSetupStatus` | Query | Returns `{ completed: boolean }` |

## Making API Calls

The tRPC client is configured in the Next.js app:

```typescript
import { trpc } from "@/utils/trpc";

// In a React component
const { data } = trpc.public.getPage.useQuery();
const { data: blocks } = trpc.blocks.list.useQuery();
```

## Error Handling

tRPC errors include:

- `UNAUTHORIZED` -- Missing or invalid session.
- `NOT_FOUND` -- Resource does not exist.
- `BAD_REQUEST` -- Invalid input (validated by Zod schemas from `packages/validators`).
- `INTERNAL_SERVER_ERROR` -- Unexpected server error.

All input is validated using shared Zod schemas from the `packages/validators` package, ensuring consistent validation between frontend forms and API endpoints.
