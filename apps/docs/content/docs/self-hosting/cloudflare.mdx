---
title: Cloudflare Deployment
description: Deploy LinkDen on Cloudflare Workers and D1 — the recommended hosting option.
---

# Cloudflare Deployment

Deploy LinkDen to Cloudflare's free tier with two Workers and a D1 database. This is the recommended hosting option — LinkDen was built for it.

## Architecture

```
┌──────────────────────────┐     ┌──────────────────────┐     ┌──────────────┐
│  Cloudflare Worker       │     │  Cloudflare Worker    │     │ Cloudflare D1│
│  linkden-web             │────▶│  linkden-api          │────▶│ (SQLite DB)  │
│  (Next.js via OpenNext)  │     │  (Hono API + tRPC)    │     │              │
└──────────────────────────┘     └──────────────────────┘     └──────────────┘
```

| Service | Purpose | Free Tier |
|---------|---------|-----------|
| **linkden-web Worker** | Next.js frontend (SSR + static assets via OpenNext) | 100,000 requests/day |
| **linkden-api Worker** | Hono API server with tRPC | 100,000 requests/day |
| **Cloudflare D1** | SQLite database for all application data | 5M rows read/day, 100K writes/day |

The web frontend is deployed using [`@opennextjs/cloudflare`](https://opennext.js.org/cloudflare), which compiles the full Next.js app into a Cloudflare Worker. The free tier is sufficient for most single-user instances.

## Prerequisites

1. A [Cloudflare account](https://cloudflare.com) (free tier works).
2. **Node.js 20+** and **pnpm 9+** installed locally.
3. The LinkDen repository cloned:

```bash
git clone https://github.com/mrdemonwolf/linkden.git
cd LinkDen
pnpm install
```

## Step 1: Create a Cloudflare API Token

You'll create a token so the deploy tooling can manage Cloudflare resources on your behalf.

1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com).
2. Go to **Profile icon > My Profile > API Tokens**.
3. Click **Create Token** and choose the **Custom token** template.
4. Add these permissions:

| Permission Scope | Resource | Access Level |
|-----------------|----------|--------------|
| Account | Cloudflare Workers Scripts | Edit |
| Account | D1 | Edit |
| Account | Workers KV Storage | Edit |

5. Under **Account Resources**, select your account.
6. Click **Continue to summary**, then **Create Token**.
7. **Copy the token immediately** — it's shown only once.

## Step 2: Find Your Account ID

Go to the [Cloudflare dashboard](https://dash.cloudflare.com) overview page. Your **Account ID** is in the right sidebar under **Account details**. Copy it.

You can also run:

```bash
npx wrangler whoami
```

## Step 3: Authenticate the Wrangler CLI

```bash
wrangler login
```

This opens a browser window for OAuth. Verify with:

```bash
wrangler whoami
```

## Step 4: Configure Environment Variables

Create a `.env` file in the project root:

```bash
# Cloudflare credentials
CLOUDFLARE_API_TOKEN=your-api-token-here
CLOUDFLARE_ACCOUNT_ID=your-account-id-here

# App URLs (update after first deploy with your actual worker URLs)
NEXT_PUBLIC_SITE_URL=https://linkden-web.<your-subdomain>.workers.dev
NEXT_PUBLIC_SERVER_URL=https://linkden-api.<your-subdomain>.workers.dev
CORS_ORIGIN=https://linkden-web.<your-subdomain>.workers.dev

# Better Auth
BETTER_AUTH_SECRET=your-random-secret-here
BETTER_AUTH_URL=https://linkden-api.<your-subdomain>.workers.dev
```

Generate a secure `BETTER_AUTH_SECRET`:

```bash
openssl rand -base64 32
```

> **Tip:** See the [Environment Variables reference](/docs/self-hosting/environment-variables) for all available options.

## Step 5: Create the D1 Database and Push Schema

Create the database:

```bash
npx wrangler d1 create linkden-db
```

Copy the `database_id` from the output and update `apps/server/wrangler.jsonc`:

```toml
[[d1_databases]]
binding = "DB"
database_name = "linkden-db"
database_id = "your-database-id-here"
```

Push the schema using one of these methods:

```bash
# Option A: Drizzle
CLOUDFLARE_ACCOUNT_ID=your-account-id CLOUDFLARE_API_TOKEN=your-token pnpm db:push

# Option B: Wrangler directly
npx wrangler d1 execute linkden-db --remote --file=packages/db/drizzle/schema.sql
```

## Step 6: Deploy

```bash
pnpm cf:deploy
```

This builds and deploys both Workers. The output shows your live URLs:

```
API:  https://linkden-api.<your-subdomain>.workers.dev
Web:  https://linkden-web.<your-subdomain>.workers.dev
```

You can also deploy each service independently:

```bash
pnpm cf:deploy:api
pnpm cf:deploy:web
```

## Step 7: Set Up Authentication

LinkDen uses **Better Auth** with email/password. On first run, the server generates a one-time setup token.

1. Check the API Worker logs for the setup URL:
   ```bash
   wrangler tail linkden-api
   ```
   Look for:
   ```
   Setup URL: https://linkden-web.<your-subdomain>.workers.dev/admin/setup?token=<unique-token>
   ```
2. Open that URL in your browser and create your admin account.
3. The token is invalidated after setup completes.
4. Sign in at `/admin/login`.

Set your auth secret as an encrypted secret on the API Worker:

```bash
cd apps/server
echo "your-better-auth-secret" | wrangler secret put BETTER_AUTH_SECRET
```

Or configure it in the dashboard: **Workers & Pages > linkden-api > Settings > Variables**.

## Step 8: Set Secrets (Optional)

If using Resend for email:

```bash
cd apps/server
echo "re_your-key" | wrangler secret put RESEND_API_KEY
```

## Step 9: Verify the Deployment

1. Visit your web Worker URL — you should see the public link page.
2. Sign in at `/admin/login` and create a test link.
3. Check that analytics are recording.

If something is off, check the Worker logs:

```bash
wrangler tail linkden-api
wrangler tail linkden-web
```

## Step 10: Custom Domains (Optional)

See the [Custom Domain guide](/docs/self-hosting/custom-domain) for full instructions.

Quick version:

1. Go to **Workers & Pages** in the Cloudflare dashboard.
2. Click your Worker > **Settings > Domains & Routes** > **Add Custom Domain**.
3. Update your environment variables with the new URLs and redeploy:

```bash
NEXT_PUBLIC_SITE_URL=https://links.yourdomain.com
NEXT_PUBLIC_SERVER_URL=https://api.yourdomain.com
CORS_ORIGIN=https://links.yourdomain.com
BETTER_AUTH_URL=https://api.yourdomain.com
```

```bash
pnpm cf:deploy
```

## Subsequent Deploys

After the initial setup, updating is one command:

```bash
git pull origin main
pnpm cf:deploy
```

## Monitoring and Logs

Stream live logs from your Workers:

```bash
wrangler tail linkden-api
wrangler tail linkden-web
wrangler tail linkden-api --status error
```

Dashboard analytics are available under **Workers & Pages > your Worker > Analytics** and **D1 > your database**.

## Tearing Down

To remove all Cloudflare resources:

```bash
pnpm cf:destroy
```

**This is irreversible.** Back up your D1 database first:

```bash
wrangler d1 export linkden-db --output backup.sql
```

The web Worker must be deleted separately from the Cloudflare dashboard.

## Troubleshooting

### "Authentication error" on deploy

Your API token may have expired or lack the required permissions. Verify with `wrangler whoami`.

### CORS errors in the browser console

`CORS_ORIGIN` on the API Worker must exactly match the web app's origin — including protocol, no trailing slash.

```bash
# Correct
CORS_ORIGIN=https://linkden-web.your-subdomain.workers.dev

# Wrong
CORS_ORIGIN=https://linkden-web.your-subdomain.workers.dev/
```

### Worker returns 1101 error

Check the logs: `wrangler tail linkden-api --status error`

Common causes: missing environment variable, D1 binding not configured, `BETTER_AUTH_SECRET` mismatch.

## Cost

For a typical single-user link page:

| Metric | Typical Usage | Free Tier Limit |
|--------|--------------|-----------------|
| Worker requests (both) | ~10K/month | 100,000/day each |
| D1 rows read | ~300/day | 5,000,000/day |
| D1 rows written | ~50/day | 100,000/day |
| D1 storage | < 50 MB | 5 GB |

Most LinkDen instances run entirely within the free tier.
