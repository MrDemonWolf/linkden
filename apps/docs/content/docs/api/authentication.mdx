---
title: Authentication
description: How authentication works in LinkDen using Better Auth to protect the admin panel and API routes.
---

# Authentication

LinkDen uses [Better Auth](https://www.better-auth.com/) for authentication with email/password sign-in. No external auth service is required.

## How It Works

1. During first-time setup at `/admin/setup`, you create an admin account with email and password.
2. After sign-up, Better Auth creates a session with secure cookies.
3. For subsequent visits, sign in at `/admin/login`.
4. The session cookie is sent with all API requests to authenticate protected routes.
5. The Hono API server validates the session using Better Auth's server-side session check.

## Session Details

Better Auth is configured with the following cookie attributes for cross-origin compatibility between the Next.js frontend and Hono API server:

| Attribute | Value | Reason |
|-----------|-------|--------|
| `sameSite` | `none` | Required for cross-origin requests (frontend and API on different origins) |
| `secure` | `true` | Required when `sameSite` is `none` |
| `httpOnly` | `true` | Prevents JavaScript access to the session cookie |

## Environment Variables

| Variable | Description | Required |
|----------|-------------|----------|
| `BETTER_AUTH_SECRET` | Secret key for session signing | Yes |
| `BETTER_AUTH_URL` | Base URL for the auth server (API server URL) | Yes |
| `CORS_ORIGIN` | Trusted origin for the frontend (single value) | Yes |

### Generating a Secret

```bash
openssl rand -base64 32
```

## Database Adapter

Better Auth uses the Drizzle adapter connecting to Cloudflare D1 (SQLite). The auth schema is defined in `packages/db/src/schema/auth` and includes the standard Better Auth tables for users, sessions, accounts, and verifications.

## Protected vs Public Routes

### Public Procedures (No Authentication)

| Procedure | Description |
|-----------|-------------|
| `public.getPage` | Full public page data (profile, blocks, theme, settings) |
| `public.submitContact` | Submit a contact form message |
| `public.trackView` | Record a page view |
| `public.trackClick` | Record a link click |
| `public.getVCard` | Download the vCard file |
| `public.getSetupStatus` | Check if setup is complete |
| `version.current` | Get current version |
| `version.checkUpdate` | Check for updates |

### Protected Procedures (Session Required)

All other procedures (blocks, settings, contacts, analytics, social, wallet, vcard, backup) require a valid Better Auth session.

## Sign-In Flow

1. User navigates to `/admin/login`.
2. Enters email and password.
3. The frontend calls `authClient.signIn.email({ email, password })`.
4. Better Auth validates credentials and returns a session cookie.
5. The user is redirected to `/admin`.

## Troubleshooting

### API returns 401 Unauthorized

- Ensure `BETTER_AUTH_SECRET` is set and consistent between deployments.
- Ensure `BETTER_AUTH_URL` matches the actual API server URL.
- Check that `CORS_ORIGIN` matches the frontend URL exactly (including protocol).
- Try signing out and back in to refresh the session.

### Cannot create account

- The setup wizard at `/admin/setup` is the only way to create the initial account.
- If setup is already complete, sign in at `/admin/login` instead.

### CORS errors on auth requests

- `CORS_ORIGIN` must exactly match the frontend URL including protocol (`https://`) with no trailing slash.
- For local development: `CORS_ORIGIN=http://localhost:3001`.
