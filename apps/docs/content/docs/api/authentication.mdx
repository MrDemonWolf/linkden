---
title: Authentication
description: How Clerk authentication works in LinkDen to protect the admin panel and API routes.
---

# Authentication

LinkDen uses [Clerk](https://clerk.com/) for authentication. Clerk handles sign-in, session management, and token verification across both the Next.js frontend and the Hono API server.

## How It Works

### Frontend (Next.js)

The Next.js app uses Clerk's React SDK and Next.js middleware:

1. **Middleware** (`middleware.ts`) intercepts all requests and checks for a valid Clerk session.
2. **Public routes** (`/`, `/qr`, `/pass`, `/privacy`, `/terms`) are accessible without authentication.
3. **Admin routes** (`/admin/*`) require authentication. Unauthenticated visitors are redirected to the Clerk sign-in page.
4. **Sign-in/Sign-up pages** are hosted by Clerk's embedded components at `/sign-in` and `/sign-up`.

### API Server (Hono)

The Hono API server verifies Clerk JWTs on protected routes:

1. Public tRPC procedures (e.g., `public.getLinks`) do not require authentication.
2. Admin tRPC procedures (e.g., `admin.links.create`) verify the Clerk session token from the `Authorization` header.
3. The Clerk SDK extracts the user ID from the JWT and makes it available in the tRPC context.

## Single-User Model

LinkDen is a single-user application. Only one person (you) should have access to the admin panel. To enforce this:

1. Go to the [Clerk Dashboard](https://dashboard.clerk.com/).
2. Navigate to **User & Authentication > Restrictions**.
3. Enable **Allowlist**.
4. Add your email address to the allowlist.
5. This prevents anyone else from creating an account.

Without the allowlist, anyone who discovers your sign-up page could create an account. Always enable the allowlist for production deployments.

## Session Management

Clerk manages sessions automatically:

- **Session tokens** are short-lived JWTs (default: 60 seconds) that are refreshed automatically.
- **Session cookies** are HTTP-only and secure.
- **Sign out** invalidates the session on both the frontend and API.

## Environment Variables

Both apps need Clerk credentials:

### Web App (`apps/web/.env`)

```bash
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
```

### API Server (`apps/server/.env`)

```bash
CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
```

Use the same Clerk application for both. The publishable key is safe to expose (it is public), while the secret key must be kept private.

## Clerk Dashboard Features

Beyond authentication, the Clerk dashboard provides:

- **User management** -- View and manage user accounts.
- **Session monitoring** -- See active sessions and revoke them.
- **Security logs** -- Audit sign-in attempts and account changes.
- **Customization** -- Style the sign-in and sign-up pages to match your brand.

## Troubleshooting

### Redirect Loop on Admin Pages

- Verify `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` is set correctly in `apps/web/.env`.
- Ensure the Clerk application is active (not paused) in the Clerk dashboard.

### API Returns 401 Unauthorized

- Check that `CLERK_SECRET_KEY` matches between the web and server apps.
- Verify the user's session has not expired (try signing out and back in).
- Check that the `Authorization` header is being sent with API requests.

### Cannot Sign Up

- Check the Clerk dashboard allowlist. If enabled, only listed emails can sign up.
- Verify the sign-up page is accessible at your configured sign-up URL.
